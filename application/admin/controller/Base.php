<?phpnamespace app\admin\controller;use \think\Controller;use \think\Config;use app\admin\model\User;/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. *//** * Description of Base * * @author 27532 */class Base extends Controller{    protected $currentMenu=array('menu'=>'','nav'=>'');    protected $isMobile = 0;    public function __construct() {        parent::__construct();        $this->init();        //$this->authAccess();    }    protected function init(){        if (strstr($_SERVER["REQUEST_URI"],'getshelvesQrCode')){        }else if (session('admin_id')==""||  session('admin_user')==""){            $this->redirect(url('/admin/login'));        }//        if(session('admin_id')==""||  session('admin_user')==""){//            /*if (isMobile()) {//                $this->redirect(url('/admin/login/mobile_login'));//            }*///            $this->redirect(url('/admin/login'));//        }        if (isMobile()) {            $this->isMobile = 1;        }        $uid = session('admin_id');        Config::load(APP_PATH.'admin/menu.php');        Config::load(APP_PATH.'user/menu.php');        $menu = Config::get('admin_menu');        $userModel = new User();        $user_data = $userModel->relation('authGroup')->where('id', $uid)->find();        if (count($user_data['authGroup']) > 0) {            $auth_id = array();            $auth_menu = array();            foreach ($user_data['authGroup'] as $k => $v) {                $auth_id = array_merge(explode(',', $v['rules']), $auth_id);            }            foreach ($auth_id as $key => $val) {                if (strpos($val, '-') != false) {                    //不是顶级                    $val_arr = explode('-', $val);                    $auth_menu[$val_arr[0]]['nav'][$val_arr[1]] = $menu[$val_arr[0]]['nav'][$val_arr[1]];                } else {                    if ($val == 'menu0') {                        $auth_menu[$val] = $menu[$val];                    } else {                        $auth_menu[$val] = array(                            'title' => $menu[$val]['title'],                            'class' => $menu[$val]['class']                        );                    }                }            }        } else {            $auth_menu = array();        }        $is_fba_auth = 0;//是否有fba权限，0无权限        if (isset($auth_menu['menu14'])) {            $is_fba_auth = 1;//如果存在14则有fba权限        }        $this->assign('title','管理后台');        $this->assign('currentMenu',$this->currentMenu);        $this->assign('menu',$auth_menu);        $this->assign('is_fba_auth', $is_fba_auth);        if ($this->isMobile == 1) {            $this->view->engine->layout('common/mobile_layout','[__REPLACE__]');        } else {            $this->view->engine->layout('common/layout','[__REPLACE__]');        }    }    protected function authAccess() {    }}