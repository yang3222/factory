<?phpnamespace app\admin\controller;use \think\Controller;use \app\admin\model\User;/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. *//** * Description of Login * * @author 27532 */class Login extends Controller{    //put your code here    public function index(){        if(session('admin_id')){            $this->redirect(url('/admin/index'));        }        $isMobile = 0;        if (is_mobile_request()) {            //$this->redirect(url('/admin/mobile_login'));            $isMobile = 1;        }        $this->assign('eventJS','login');        $this->assign('isMobile',$isMobile);        if ($isMobile == 1) {            return $this->fetch('login/mobile_login');        } else {            return $this->fetch();        }    }    public function mobile_login() {        if(session('admin_id')){            $this->redirect(url('/admin/mobile_login'));        }        //$this->assign('eventJS','login');        return $this->fetch();    }    public function checklogin(){        header("Content-type:text/html;charset=utf-8");        $sessionCode=strtolower(session('admin_code'));        $postCode=strtolower(input('post.Code','','trim'));        if($sessionCode!=$postCode)exit('验证码错误');        $User=input('post.User','','trim');        $Pwd=base64_encode(input('post.Pwd','','trim').'admin');        $user=  User::get(['User' => $User,'Pwd'=>$Pwd,'reviewed'=>'1','Type'=>'1'],'userinfo');        if($user==null){            exit('账号/密码错误，请重新输入');        }else{            session('admin_id',$user->id);            session('admin_name',$user->userinfo->Name);            session('admin_user',$user->User);            session('admin_pwd',$user->Pwd);            session('admin_operation_auth',$user->operation_auth);            echo true;        }    }    //扫码登录    public function usercode_checklogin(){        header("Content-type:text/html;charset=utf-8");        $user_code = input('post.user_code', '', 'trim');        if (empty($user_code)) return json(['code' => 1001, 'msg' => '缺少用户登录码！']);        $encode_user = base64_decode($user_code);        $pwd_user = explode('p&r', $encode_user);        if (empty($pwd_user[1]) || empty($pwd_user[0])) return json(['code' => 1001, 'msg' => '用户登录码有误！']);        $Users = $pwd_user[1];        $Pwd = base64_encode($pwd_user[0].'admin');        $user = User::get(['User' => $Users,'Pwd' => $Pwd,'reviewed' => '1','Type' => '1'],'userinfo');        if($user == null){            //exit('账号/密码错误，请重新输入');            return json(['code' => 1001, 'msg' => '用户登录码错误，请重新输入']);        }else{            session('admin_id',$user->id);            session('admin_name',$user->userinfo->Name);            session('admin_user',$user->User);            session('admin_pwd',$user->Pwd);            session('admin_operation_auth',$user->operation_auth);            //echo true;            return json(['code' => 1000, 'msg' => '登录成功']);        }    }    public function logout(){        session('admin_id', null);        session('admin_name', null);        session('admin_user', null);        session('admin_pwd', null);        $this->redirect(url('/admin/login'));    }    //登录的图片验证码    public function code() {        import('widget.codeWidget', EXTEND_PATH);        $_vc = new \codeWidget();        $_vc->doimg();        $code = $_vc->getCode();        session('admin_code', null);        session('admin_code', $code);        return $_vc->getCode();        //exit;    }}