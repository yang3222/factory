<link rel="stylesheet" href="{:ADMIN_STYLE_URL}css/date.css" type="text/css" media="screen" /><style>    .orderli th {        border-width: 1px;        border-style: solid;        border-color: #e6e6e6;    }    .orderli td {        border-width: 1px;        border-style: solid;        border-color: #e6e6e6;    }    .total_gds {        font-size: 13px;        font-weight: bold;    }</style><script type="text/javascript" src="{:ADMIN_STYLE_URL}js/date.js"></script><script>    $(function(){//var aaa = "$aa";	$('.custom-date').dateRangePicker($("input[name='start_date']"),$("input[name='end_date']"));        order.productsearch="{$searchproduct}".split(",");        order.factorysearch="{$searcfactory}".split(",");        select.select();    })</script><div class="canvas_title height_title do-clear">    <ul class="tab_nav ordertab fl">        <li {if condition="empty($sign)"}class="current"{/if}><a href="{:url('/admin/order/index')}">全部</a></li>        <li {if condition="$sign==1"}class="current"{/if}><a href="{:url('/admin/order/index','type=1')}">新订单</a></li>        <li {if condition="$sign==2"}class="current"{/if}><a href="{:url('/admin/order/index','type=2')}">生产中</a></li>        <li {if condition="$sign==8"}class="current"{/if}><a href="{:url('/admin/order/index','type=8')}">有库存未出库</a></li>        <li {if condition="$sign==7"}class="current"{/if}><a href="{:url('/admin/order/index','type=7')}">未设置工厂</a></li>        <li {if condition="$sign==3"}class="current"{/if}><a href="{:url('/admin/order/index','type=3')}">已出库</a></li>        <li {if condition="$sign==4"}class="current"{/if}><a href="{:url('/admin/order/index','type=4')}">暂停</a></li>        <li {if condition="$sign==5"}class="current"{/if}><a href="{:url('/admin/order/index','type=5')}">已签收</a></li>        <li {if condition="$sign==6"}class="current"{/if}><a href="{:url('/admin/order/index','type=6')}">已取消</a></li>    </ul>    <ul class="tab_btn tab_btn_fl fr">        {if condition="$sign==8"}        <li><a href="javaScript:orderBywarehouse.updateAll('{:url('/admin/epwarehouse/adddisLists')}')">批量添加配货单</a></li>        {/if}        <li><a href="{:url('/admin/order/signorder')}">同步签收</a></li>        {if condition="$operation_auth==1"} {if condition="$sign==7"}<li><a href="javaScript:orderoperation.batchSetFactory('{:url('/admin/order/setFactory/batchsefactory')}')">批量设置工厂</a></li>{/if} {else}{/if}      <li><a href="javaScript:orderoperation.setSignAll('{:url('/admin/order/setsignAll')}')">设为签收</a></li>        <li><a href="javaScript:openModel.openWindow('{:url('/admin/product/openwindows')}')">按产品</a></li>        <li><a href="javaScript:openModel.openWindow('{:url('/admin/factory/openWindows')}')">按工厂</a></li>        <li class="date">            <select class='custom-date' name='custom_date' id="date">                <option value='7'  selected='selected'>7天</option>                <option value='30' >30 天</option>                <option value='90' >90 天</option>                <option value='180' >180 天</option>                <option value='365' >365 天</option>                <option value='custom' >自定义</option>            </select>            <input type="hidden" name="start_date" id="start_date" value="{$date.start_time}">            <input type="hidden" name="end_date" id="end_date" value="{$date.end_time}">        </li>        <li class="input"><input type="text" id="search" name="search" value="" style="width: 150px;"      onkeydown="keyFun.key(event,13,order.search,[$('#search'),'{:url('/admin/order/index','type='.$sign)}'])"       placeholder="搜索：产品名称/产品ID" /></li>      <li><a href="javaScript:order.search([$('#search'),'{:url('/admin/order/index','type='.$sign)}'])">搜索</a></li>    </ul></div><div class="canvas_intro">    <table class="productli orderli">        <thead>            <tr>                <th width="10" class="center">#</th>                <th width="20" class="center"><input name="" type="checkbox" value="" id="select" /></th>                <th width="180">订单信息</th>                <th width="130" class="center">缩略图</th>                <th width="80" class="center">型号/数量</th>                <th class="center">备注</th>                <th class="center" width="200">生产状态</th>                <th class="center" width="200">加工厂/状态</th>                <th class="center" width="120">时间</th>                <th class="center" width="150">操作</th>            </tr>        </thead>        <tbody>        <tr><td></td><td></td><td></td><td class="center total_gds">产品总量：</td><td class="center total_gds" id="total_gds">{$total_gds}</td><td></td><td></td><td></td><td></td><td></td></tr>            {volist name='list' id='value' key='k'}            <tr>                <td class="center">{$k}</td>                <td class="center">                    <input name="select" type="checkbox" value="{if condition="$value.status==0||$value.status==4||$value.status==5"}{$value.id}{/if}" data-odrid="{if condition="$value.status==0||$value.status==4"}{$value.OdrId}{/if}" />                </td>                <td class="info">                    <label>id：</label>{$value.id}<br/>                    <label>订单号：</label>{$value.OrdNum}<br/>                    <label>SKU：</label>{$value.GdsSku}<br/>                    <label>运单号：</label>{$value.TrnNo}<br/>                    <label>批次号：</label>{$value.BatchCode}<br/>                    <label>分销商：</label>{$value.AgntName}<br/>                    <label>来源：</label>{$value.Type}<br/>                    <label>产品ID：</label>{$value.product_id}<br/>                    <label>产品名称：</label>{$value.product_arr.name}<br/>                    <label>订单类型：</label>{$isFba[$value.IsFBA]}<br/>                </td>                <td  class="center"><img src='http://kjds-img.img-cn-shanghai.aliyuncs.com/{:explode(',',$value.ImgURL)[0]}@0e_0o_1l_500h_500w.src' /></td>                <td class="center num {if condition="$value.Urgent==1"}urgent{/if}">                    <span>{$value.SpecName}</span><br/><strong>{$value.GdsNum}件</strong>                    {if condition="$value.Urgent==1"}<br/><strong>!加急</strong>{/if}                </td>                <td>                    {if !empty($value.OdrMemo)}<span>客户：</span>{$value.OdrMemo}<br/>{/if}                    {if !empty($value.FFYMemo)}<span>平台：</span>{$value.FFYMemo}<br/>{/if}                    {if !empty($value.SignMemo)}<span>签收：</span>{$value.SignMemo}{/if}                </td>                <td class="center">                    {volist name='value.production_status' id='order_status_id' key='osikey'}                    {if condition="$osikey <= 4"}                    <br class="prostatus">{$order_status_id.status} </br>                    <span>{$order_status_id.add_time|mb_substr=0,16,'utf-8'}</span>                    {else}                    {/if}                    {/volist}                </td>                <td class="center">                    <ul class="factory">                        {if condition="$value.status == 3 && count($value.orderFactory) <= 0"}该订单已经取消{else}                    {assign name="factorys" value=":GetOrderFactory($value.id)"}                    {volist name='value.orderFactory' id='factory'}                    <li>                        {if condition="$factory.sign==0"}{assign name="sign_type" value="新订单"/}{assign name="signtime" value='$value.GetTimer'}                        {elseif condition="$factory.sign==1"}{assign name="sign_type" value="生产中"/}{assign name="signtime" value='$factory.pro_time'}                        {elseif condition="$factory.sign==2"}{assign name="sign_type" value="已出库"/}{assign name="signtime" value='$factory.library_time'}{/if}                        <h4><b>{if condition="$factory.working_type=='1'"}印花：{else}加工：{/if}</b>{$factory.userinfo.Name}</h4>                        {if condition="$value.status==1"}<span class="stop">暂停</span><i>{:date('Y-m-d H:i',strtotime($value.SignTimer))}</i>                        {elseif condition="$value.status==2"}<span class="sign">签收</span><i>{:date('Y-m-d',strtotime($value.SignTimer))}</i>                        {elseif condition="$value.status==3"}<span class="cancel">({$sign_type}) 取消</span><i>{:date('Y-m-d',strtotime($value.SignTimer))}</i>                        {else}                        <span>{$sign_type}</span><i>{:date('Y-m-d H:i',strtotime($signtime))}</i>                        {/if}                    </li>                    {/volist}{/if}                    </ul>                </td>                <td class="info center" >                    <label>亚马逊：</label>{:date('Y-m-d',strtotime($value.AmzTimer))}<br/>                    <label>提交：</label>{:date('Y-m-d',strtotime($value.GetTimer))}<br/>                    {if condition="$value.status<2  || $value.status==4"}{assign name="endtime" value=":date('Y-m-d h:i:s')"}{else}{assign name="endtime" value="$value.SignTimer"}{/if}                    <label>时效：</label><strong>{if condition="$value.status == 5"}0{else}{assign name='alldata' value=":floor((strtotime($endtime)-strtotime($value.AmzTimer))/(3600*24))"}{if condition="$alldata>0"}{$alldata}{else}0{/if}{/if}天</strong>                </td>                <td class="center operation">                    <ul class="do-clear operation">                        {if condition="$operation_auth==1"} <li><a {if condition="$value.Urgent==0&&$value.status!=2"}href="javaScript:orderoperation.setUrgent('{:url('/admin/order/seturgent')}','{$value.id}')"{else}href="javaScript:;" class="enabled"{/if}>订单加急</a></li> {else} {/if}                        <li><a {if condition="$value.status!=2"}href="javaScript:orderoperation.setMemo('{:url('/admin/order/setmemo','id='.$value.id)}','{$value.FFYMemo}')"{else}href="javaScript:;" class="enabled"{/if}>生产备注</a></li>                        {if condition="$operation_auth==1"}<li><a {if condition="$value.status==0"}href="javaScript:orderoperation.setSign('{:url('/admin/order/setsign','id='.$value.id)}','1','{$value.SignMemo}')"{else}href="javaScript:;" class="enabled"{/if}>暂停生产</a></li>{else} {/if}                        {if condition="$operation_auth==1"} <li><a {if condition="$value.status==1"}href="javaScript:orderoperation.setSign('{:url('/admin/order/setsign','id='.$value.id)}','0','{$value.SignMemo}')"{else}href="javaScript:;" class="enabled"{/if}>恢复生产</a></li>{else} {/if}                        {if condition="$operation_auth==1"} <li><a {if condition="$value.status!=3&&$value.status!=2"}href="javaScript:orderoperation.setSign('{:url('/admin/order/setsign','id='.$value.id)}','3','{$value.SignMemo}')"{else}href="javaScript:;" class="enabled"{/if}>取消订单</a></li>{else} {/if}                        {if condition="$operation_auth==1"}<li><a {if condition="$value.status!=12&&$value.status!=4"}href="javaScript:orderoperation.setAgain('{:url('/admin/order/setgain','id='.$value.id)}','{$value.SignMemo}')"{else}href="javaScript:;" class="enabled"{/if}>重新生产</a></li>{else} {/if}                        <li><a href="javaScript:openModel.openWindow('{:url('/admin/order/intro','id='.$value.id)}')">订单详情</a></li>                        <li><a href="javaScript:openModel.openWindow('{:url('/admin/order/prostatus_detail','id='.$value.id)}')">生产详情</a></li>                        <li><a  {if condition="$value.status<2||$value.status==5"}href="javaScript:orderoperation.setSign('{:url('/admin/order/setsign','id='.$value.id)}','2','{$value.SignMemo}')"{else}href="javaScript:;" class="enabled"{/if}>设为签收</a></li>                        {if condition="$operation_auth==1"}                        {if condition="$value.status==4"}                        <li><a href="javaScript:orderstatus.getorderstatus({$value.OdrId}, '{:url('/admin/order/setFactory/'.$value.id)}')">设置工厂</a></li>                        {else}                        <li><a {if condition="$value.status<2"}href="javaScript:openModel.openWindow('{:url('/admin/order/showfactorys/'.$value.id)}')"{else} href="javaScript:;"  class="enabled"{/if}>修改工厂</a></li>                        {/if}{else} {/if}                        {if condition="$sign==8"}                        <li><a href="javaScript:orderBywarehouse.update('{$value.id}','{:url('/admin/epwarehouse/adddisLists')}')">加入配货单</a></li>                        {/if}                    </ul>                </td>            </tr>            {/volist}        </tbody>    </table></div><div class="canvas_title do-clear">    {$pageDiv}</div><div class="message" id="tip_windows">    <div class="box">        <h3>修改备注<a href="javaScript:windowoperation.hide($('#tip_windows'))" class="close"><img src="{:ADMIN_STYLE_URL}images/closecut.png" /></a></h3>        <textarea name="" cols="" rows="" id="message"></textarea>        <div class="btn"><a href="javaScript:orderoperation.yesclick($('#message').val());">确认</a><a href="javaScript:windowoperation.hide($('#tip_windows'))">取消</a></div>    </div></div><script>    //批量签收    var orderstatus = {        getorderstatus:function(id,openurl) {            var url = 'http://webapi.38420.com/api/Order/QueryByIds';            $.ajax({                type: "post",                url: url,                data: {OrderIDs: id},                async: false,                success: function(data) {                    var arr = data;                    var cancel = false;                    for (var i = 0; i < arr.length; i++) {                        if (arr[i]['OdrStatus'] == 4.0) {                            cancel = true;                        }                    }                    if (cancel) {                        alert('有定单取消，请刷新页面');                        return;                    } else {                        openModel.openWindow(openurl);                    }                    //                }            });        },    };    $.post("{:url('admin/order/allData')}", {}, function(total) {        var total_div = document.getElementById("total_gds");        total_div.innerHTML = total['total_gds'];        console.log(total);        return;    });</script>