<?phpnamespace app\user\controller;use \think\Controller;use \think\Config;use app\admin\model\User;/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. *//** * Description of Base * * @author 27532 */class Base extends Controller{    protected $currentMenu=array('menu'=>'','nav'=>'');    protected $user_id;    protected $isMobile = 0;    public function __construct() {        parent::__construct();        $this->init();    }    protected function init(){        if(session('user_id')==""||session('user_user')==""){            $this->redirect(url('/user/login'));        }        if (isMobile()) {            $this->isMobile = 1;        }        $this->user_id=session('user_id');        Config::load(APP_PATH.'user/menu.php');        $menu = Config::get('user_menu');        $uid = $this->user_id;        $userModel = new User();        $user_data = $userModel->relation('authGroup')->where('id', $uid)->find();        if (count($user_data['authGroup']) > 0) {            $auth_id = array();            $auth_menu = array();            foreach ($user_data['authGroup'] as $k => $v) {                $auth_id = array_merge(explode(',', $v['rules']), $auth_id);            }            foreach ($auth_id as $key => $val) {                if (strpos($val, '-') != false) {                    //不是顶级                    $val_arr = explode('-', $val);                    $auth_menu[$val_arr[0]]['nav'][$val_arr[1]] = $menu[$val_arr[0]]['nav'][$val_arr[1]];                } else {                    if ($val == 'ybp') {                        $auth_menu[$val] = $menu[$val];                    } else {                        $auth_menu[$val] = array(                            'title' => $menu[$val]['title'],                            'class' => $menu[$val]['class']                        );                    }                }            }        } else {            $auth_menu = array();        }        $this->assign('title','工厂管理');        $this->assign('currentMenu',$this->currentMenu);        $this->assign('menu',$auth_menu);        if ($this->isMobile == 1) {            $this->view->engine->layout('common/mobile_layout','[__REPLACE__]');        } else {            $this->view->engine->layout('common/layout','[__REPLACE__]');        }    }}